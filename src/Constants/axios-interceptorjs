import axios from "axios";
import { getCookie, setCookie } from "../utils/helpers/Cookie";

const getAccessToken = async () => {
    const cookie = await getCookie("credential");
    return cookie?.access_token;
};

const getRefreshToken = async () => {
    const cookie = await getCookie("credential");
    return cookie?.refresh_token;
};

export const apiClient = axios.create({
    baseURL: "https://api.escuelajs.co/api/v1",
    headers: {
        Authorization: `Bearer ${await getAccessToken()}`,
    },
});

apiClient.interceptors.response.use((response)=>response,
async (error) => {
  const originalRequest = error.config;
  if(error.response.status===401 && !originalRequest._retry){
    originalRequest._retry = true;

    try {
        const refreshToken = await getAccessToken();
    }catch (error) {
        console.log("failed to submit new refresh token!");
        return Promise.reject(error);
    }

  }

}
);

export default apiClient;


